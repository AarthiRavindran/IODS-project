#Aarthi Ravindran, 13th September 2019

#Data Wrangling - 5 points
#1. Take the data file student-mat.csv and student-por.csv from given link.  
#2. Creat new rscript in 'create_alc.R' and save in data file
#3. Read both student-mat.csv and student-por.csv files and explore the structure and dimensions of the data.  

# Reading the files
student_mat <- read.csv("C:/Users/Aarthi/Documents/IODS-project/data/student-mat.csv", sep = ";", header = TRUE)
student_por <- read.csv("C:/Users/Aarthi/Documents/IODS-project/data/student-por.csv", sep = ";", header = TRUE)
# Explore the files
dim(student_mat)
#ans:
#[1] 395  33
dim(student_por)
#ans
#[1] 649  33
str(student_mat)
#'data.frame':	395 obs. of  33 variables:
#$ school    : Factor w/ 2 levels "GP","MS": 1 1 1 1 1 1 1 1 1 1 ...
#$ sex       : Factor w/ 2 levels "F","M": 1 1 1 1 1 2 2 1 2 2 ...
#$ age       : int  18 17 15 15 16 16 16 17 15 15 ...
#$ address   : Factor w/ 2 levels "R","U": 2 2 2 2 2 2 2 2 2 2 ...
#$ famsize   : Factor w/ 2 levels "GT3","LE3": 1 1 2 1 1 2 2 1 2 1 ...
#$ Pstatus   : Factor w/ 2 levels "A","T": 1 2 2 2 2 2 2 1 1 2 ...
#$ Medu      : int  4 1 1 4 3 4 2 4 3 3 ...
#$ Fedu      : int  4 1 1 2 3 3 2 4 2 4 ...
#$ Mjob      : Factor w/ 5 levels "at_home","health",..: 1 1 1 2 3 4 3 3 4 3 ...
#$ Fjob      : Factor w/ 5 levels "at_home","health",..: 5 3 3 4 3 3 3 5 3 3 ...
#$ reason    : Factor w/ 4 levels "course","home",..: 1 1 3 2 2 4 2 2 2 2 ...
#$ guardian  : Factor w/ 3 levels "father","mother",..: 2 1 2 2 1 2 2 2 2 2 ...
#$ traveltime: int  2 1 1 1 1 1 1 2 1 1 ...
#$ studytime : int  2 2 2 3 2 2 2 2 2 2 ...
#$ failures  : int  0 0 3 0 0 0 0 0 0 0 ...
#$ schoolsup : Factor w/ 2 levels "no","yes": 2 1 2 1 1 1 1 2 1 1 ...
#$ famsup    : Factor w/ 2 levels "no","yes": 1 2 1 2 2 2 1 2 2 2 ...
#$ paid      : Factor w/ 2 levels "no","yes": 1 1 2 2 2 2 1 1 2 2 ...
#$ activities: Factor w/ 2 levels "no","yes": 1 1 1 2 1 2 1 1 1 2 ...
#$ nursery   : Factor w/ 2 levels "no","yes": 2 1 2 2 2 2 2 2 2 2 ...
#$ higher    : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
#$ internet  : Factor w/ 2 levels "no","yes": 1 2 2 2 1 2 2 1 2 2 ...
#$ romantic  : Factor w/ 2 levels "no","yes": 1 1 1 2 1 1 1 1 1 1 ...
#$ famrel    : int  4 5 4 3 4 5 4 4 4 5 ...
#$ freetime  : int  3 3 3 2 3 4 4 1 2 5 ...
#$ goout     : int  4 3 2 2 2 2 4 4 2 1 ...
#$ Dalc      : int  1 1 2 1 1 1 1 1 1 1 ...
#$ Walc      : int  1 1 3 1 2 2 1 1 1 1 ...
#$ health    : int  3 3 3 5 5 5 3 1 1 5 ...
#$ absences  : int  6 4 10 2 4 10 0 6 0 0 ...
#$ G1        : int  5 5 7 15 6 15 12 6 16 14 ...
#$ G2        : int  6 5 8 14 10 15 12 5 18 15 ...
#$ G3        : int  6 6 10 15 10 15 11 6 19 15 ...
str(student_por)
#ans
#'data.frame':	649 obs. of  33 variables:
#$ school    : Factor w/ 2 levels "GP","MS": 1 1 1 1 1 1 1 1 1 1 ...
#$ sex       : Factor w/ 2 levels "F","M": 1 1 1 1 1 2 2 1 2 2 ...
#$ age       : int  18 17 15 15 16 16 16 17 15 15 ...
#$ address   : Factor w/ 2 levels "R","U": 2 2 2 2 2 2 2 2 2 2 ...
#$ famsize   : Factor w/ 2 levels "GT3","LE3": 1 1 2 1 1 2 2 1 2 1 ...
#$ Pstatus   : Factor w/ 2 levels "A","T": 1 2 2 2 2 2 2 1 1 2 ...
#$ Medu      : int  4 1 1 4 3 4 2 4 3 3 ...
#$ Fedu      : int  4 1 1 2 3 3 2 4 2 4 ...
#$ Mjob      : Factor w/ 5 levels "at_home","health",..: 1 1 1 2 3 4 3 3 4 3 ...
#$ Fjob      : Factor w/ 5 levels "at_home","health",..: 5 3 3 4 3 3 3 5 3 3 ...
#$ reason    : Factor w/ 4 levels "course","home",..: 1 1 3 2 2 4 2 2 2 2 ...
#$ guardian  : Factor w/ 3 levels "father","mother",..: 2 1 2 2 1 2 2 2 2 2 ...
#$ traveltime: int  2 1 1 1 1 1 1 2 1 1 ...
#$ studytime : int  2 2 2 3 2 2 2 2 2 2 ...
#$ failures  : int  0 0 0 0 0 0 0 0 0 0 ...
#$ schoolsup : Factor w/ 2 levels "no","yes": 2 1 2 1 1 1 1 2 1 1 ...
#$ famsup    : Factor w/ 2 levels "no","yes": 1 2 1 2 2 2 1 2 2 2 ...
#$ paid      : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
#$ activities: Factor w/ 2 levels "no","yes": 1 1 1 2 1 2 1 1 1 2 ...
#$ nursery   : Factor w/ 2 levels "no","yes": 2 1 2 2 2 2 2 2 2 2 ...
#$ higher    : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...
#$ internet  : Factor w/ 2 levels "no","yes": 1 2 2 2 1 2 2 1 2 2 ...
#$ romantic  : Factor w/ 2 levels "no","yes": 1 1 1 2 1 1 1 1 1 1 ...
#$ famrel    : int  4 5 4 3 4 5 4 4 4 5 ...
#$ freetime  : int  3 3 3 2 3 4 4 1 2 5 ...
#$ goout     : int  4 3 2 2 2 2 4 4 2 1 ...
#$ Dalc      : int  1 1 2 1 1 1 1 1 1 1 ...
#$ Walc      : int  1 1 3 1 2 2 1 1 1 1 ...
#$ health    : int  3 3 3 5 5 5 3 1 1 5 ...
#$ absences  : int  4 2 6 0 0 6 0 2 0 0 ...
#$ G1        : int  0 9 12 14 11 12 13 10 15 12 ...
#$ G2        : int  11 11 13 14 13 12 12 13 16 12 ...
#$ G3        : int  11 11 12 14 13 13 13 13 17 13 ...

#Join the data
library(dplyr)
join_by <- c("school", "sex", "age", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", "Fjob", "reason", "nursery","internet")
student_mat_por_joined <- inner_join(student_mat, student_por, by=join_by)
dim(student_mat_por_joined)
#[1] 382  53
str(student_mat_por_joined)
#'data.frame':	382 obs. of  53 variables:
#$ school      : Factor w/ 2 levels "GP","MS": 1 1 1 1 1 1 1 1 1 1 ...
#$ sex         : Factor w/ 2 levels "F","M": 1 1 1 1 1 2 2 1 2 2 ...
#$ age         : int  18 17 15 15 16 16 16 17 15 15 ...
#$ address     : Factor w/ 2 levels "R","U": 2 2 2 2 2 2 2 2 2 2 ...
#$ famsize     : Factor w/ 2 levels "GT3","LE3": 1 1 2 1 1 2 2 1 2 1 ...
#$ Pstatus     : Factor w/ 2 levels "A","T": 1 2 2 2 2 2 2 1 1 2 ...
#$ Medu        : int  4 1 1 4 3 4 2 4 3 3 ...
#$ Fedu        : int  4 1 1 2 3 3 2 4 2 4 ...
#$ Mjob        : Factor w/ 5 levels "at_home","health",..: 1 1 1 2 3 4 3 3 4 3 ...
#$ Fjob        : Factor w/ 5 levels "at_home","health",..: 5 3 3 4 3 3 3 5 3 3 ...
#$ reason      : Factor w/ 4 levels "course","home",..: 1 1 3 2 2 4 2 2 2 2 ...
#$ guardian.x  : Factor w/ 3 levels "father","mother",..: 2 1 2 2 1 2 2 2 2 2 ...
#$ traveltime.x: int  2 1 1 1 1 1 1 2 1 1 ...
#$ studytime.x : int  2 2 2 3 2 2 2 2 2 2 ...
#.
#.
#.
#.
#$ G1.y        : int  0 9 12 14 11 12 13 10 15 12 ...
#$ G2.y        : int  11 11 13 14 13 12 12 13 16 12 ...
#$ G3.y        : int  11 11 12 14 13 13 13 13 17 13 ...

glimpse(student_mat_por_joined)

# result intepretation : when i eplore joined data, it seems the duplicates are joined as x and y cordinates, so we have to remove the duplicates

#To combine the duplicates
# create a new data frame with only the joined columns
alc <- select(student_mat_por_joined, one_of(join_by))

# columns that were not used for joining the data
notjoined_columns <- colnames(student_mat)[!colnames(student_mat) %in% join_by]

# print out the columns not used for joining
notjoined_columns

# for every column name not used for joining...
for(column_name in notjoined_columns) {
  # select two columns from 'math_por' with the same original name
  two_columns <- select(student_mat_por_joined, starts_with(column_name))
  # select the first column vector of those two columns
  first_column <- select(two_columns, 1)[[1]]
  
  # if that first column  vector is numeric...
  if(is.numeric(first_column)) {
    # take a rounded average of each row of the two columns and
    # add the resulting vector to the alc data frame
    alc[column_name] <- round(rowMeans(two_columns))
  } else { # else if it's not numeric...
    # add the first column vector to the alc data frame
    alc[column_name] <- first_column
  }
}

# glimpse at the new combined data
glimpse(alc)
#Observations: 382
#Variables: 33
#$ school     <fct> GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, G...
#$ sex        <fct> F, F, F, F, F, M, M, F, M, M, F, F, M, M, M, F, F, F, M, M, M, M, M, M, F, F, M, M, M, M, M, M, M...
#$ age        <int> 18, 17, 15, 15, 16, 16, 16, 17, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 17, 16, 15, 15, 16, 16, 1...
#
#
#
#$ G2         <dbl> 8, 8, 10, 14, 12, 14, 12, 9, 17, 14, 11, 12, 14, 11, 15, 16, 14, 12, 6, 11, 14, 14, 14, 12, 10, 1...
#$ G3         <dbl> 8, 8, 11, 14, 12, 14, 12, 10, 18, 14, 12, 12, 13, 12, 16, 16, 14, 12, 6, 11, 14, 14, 15, 11, 9, 1...

#Take average of weekend and weekday alcohol consumption by creating new column in the data
alc <- mutate(alc, alc_use = (Dalc + Walc) / 2)
#Create new column by highuse in which the students who have value more than 2 is TRUE
alc <- mutate(alc, high_use = "alc_use" > 2)
glimpse(alc)
#Observations: 382
#Variables: 35
#$ school     <fct> GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, GP, G...
#$ sex        <fct> F, F, F, F, F, M, M, F, M, M, F, F, M, M, M, F, F, F, M, M, M, M, M, M, F, F, M, M, M, M, M, M, M...
#......
#.....
write.csv(alc, "C:/Users/Aarthi/Documents/IODS-project/data/new_data.csv")
write.table(alc, "C:/Users/Aarthi/Documents/IODS-project/data/new_data.txt")
